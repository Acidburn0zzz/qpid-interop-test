QUICKSTART GUIDE
================

0. Prerequisites
----------------
* qpid-proton built and installed
* For JMS testing, qpid-jms built and installed

1. Get the source
-----------------
git clone https://git-wip-us.apache.org/repos/asf/qpid-interop-test.git

2. Patch Proton and build
-------------------------
Proton needs to be patched with a change that adds support for the missing AMQP types in the current
python implementation. This patch will be proposed as a patch to Proton itself, and if accepted,
this part of the procedure will go away. Until then, the patch is located in the etc directory as
proton-python-amqp-types.patch. Copy this to the qpid-proton directory, then:

cd <path/to/>qpid-proton
patch -p1 proton-python-amqp-types.patch
cd build/
make
sudo make install
cd ..
mvn -DskipTests package
mvn -DskipTests install

3. Build Qpid JMS
-----------------
cd <path/to/>qpid-jms
mvn -DskipTests package
mvn -DskipTests install


3 Prepare the tests
-------------------
(ONLY IF NEEDED): Edit src/py/qpid_interop/types/simple_type_tests.py as
needed, particularly AmqpPrimitiveTypes.TYPE_MAP which controls the AMQP types
and test values for each type.

4. Run the tests (uninstalled)
------------------------------
Note that installation is still to be completed, this section will change to
reflect installation details when complete.

qpid-proton installed:
Assuming proton's "make install" has been run, from top level qpid-interop-test directory:
export PYTHONPATH=/usr/local/lib64/proton/bindings/python:src/py/qpid-interop-test
export LD_LIBRARY_PATH=/usr/local/lib64
export QPID_INTEROP_TEST_HOME=<abs path to top level qpid-interop-test directory>

qpid-proton built but not installed:
Assuming proton's "make" has been run from a "build" directory as described in the proton README (but not make install), from top level qpid-interop-test directory:
export PYTHONPATH=<abs path to top level qpid-proton directory>/proton-c/bindings/python:<abs path to top level qpid-proton directory>/build/proton-c/bindings/python:src/py/qpid-interop-test
export LD_LIBRARY_PATH=<abs path to top level qpid-proton directory>/build/proton-c
export QPID_INTEROP_TEST_HOME=<abs path to top level qpid-interop-test directory>

Start a broker (Active-MQ or Qpid).
NOTE: For qpidd, YOU MUST USE THE --queue-pattern qpid-interop parameter so it will create non-existent queues as needed.
NOTE: For qpidd, there are some bugs in the broker which will cause the simple type tests for the following types to fail:
      * char
      * decimal32
      * decimal64
      * deciaml128 
      See https://issues.apache.org/jira/browse/QPID-6328 for more info on this.

From top level directory:
./src/py/qpid-interop-test/jms/jms_message_tests.py
./src/py/qpid-interop-test/types/simple_type_tests.py

